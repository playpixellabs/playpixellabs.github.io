{{/* 1. Aspect Ratio Choice */}}
{{ $ratioStr := default "16:9" (.Get "ratio") }}
{{ $aspectMap := dict "16:9" "gc-aspect-16-9" "9:16" "gc-aspect-9-16" "4:3" "gc-aspect-4-3" "3:4" "gc-aspect-3-4" }}
{{ $aspectClass := index $aspectMap $ratioStr | default "gc-aspect-16-9" }}
{{ $gcID := printf "gc-%d" .Ordinal }}

<div id="{{ $gcID }}" class="gc-container {{ $aspectClass }}">
  <div class="gc-inner-gradient"></div>
  <div class="gc-game-content">
    {{ .Inner }}
  </div>
  <div class="gc-toolbar">
    <button class="gc-btn gc-btn-mute" aria-label="Toggle Mute">
      <svg class="gc-icon" xmlns="http://www.w3.org/2000/svg" fill="none"
           viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M11 5L6 9H2v6h4l5 4V5z" />
      </svg>
      <span>Mute</span>
    </button>
    <div class="gc-toolbar-spacer"></div>
    <button class="gc-btn gc-btn-fullscreen" aria-label="Toggle Fullscreen">
      <svg class="gc-icon" xmlns="http://www.w3.org/2000/svg" fill="none"
           viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round"
              stroke-width="2"
              d="M4 8V4h4M4 4l5 5m11-5v4h-4m4-4l-5 5M4 16v4h4M4 20l5-5m11 5v-4h-4m4 4l-5-5"/>
      </svg>
      <span>Fullscreen</span>
    </button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const container = document.getElementById('{{ $gcID }}');
  const fullscreenBtn = container.querySelector('.gc-btn-fullscreen');
  const muteBtn = container.querySelector('.gc-btn-mute');
  const muteIcon = muteBtn.querySelector('.gc-icon');

  // Fullscreen
  const enterFullscreen = () => {
    if (container.requestFullscreen) container.requestFullscreen();
    else if (container.webkitRequestFullscreen) container.webkitRequestFullscreen();
    else if (container.msRequestFullscreen) container.msRequestFullscreen();
  };
  const exitFullscreen = () => {
    if (document.exitFullscreen) document.exitFullscreen();
    else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
    else if (document.msExitFullscreen) document.msExitFullscreen();
  };
  fullscreenBtn.addEventListener('click', () =>
    document.fullscreenElement ? exitFullscreen() : enterFullscreen()
  );
  document.addEventListener('fullscreenchange', () => {
    const isFull = !!document.fullscreenElement;
    container.classList.toggle('gc-fullscreen', isFull);
    fullscreenBtn.querySelector('span').textContent = isFull ? 'Exit Fullscreen' : 'Fullscreen';
  });

  // Mute Button (example)
  let isMuted = false;
  muteBtn.addEventListener('click', () => {
    isMuted = !isMuted;
    muteBtn.querySelector('span').textContent = isMuted ? 'Unmute' : 'Mute';
    muteIcon.innerHTML = isMuted
      ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5L6 9H2v6h4l5 4V5z M15 9l4 4m0-4l-4 4"/>'
      : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5L6 9H2v6h4l5 4V5z" />';
    const audioEl = container.querySelector('audio, video');
    if (audioEl) audioEl.muted = isMuted;
  });
});
</script>

<style>
/* Aspect Ratios */
.gc-aspect-16-9 { padding-top: 56.25%; }
.gc-aspect-9-16 { padding-top: 177.78%; }
.gc-aspect-4-3  { padding-top: 75%;    }
.gc-aspect-3-4  { padding-top: 133.33%;}

/* Main container */
.gc-container {
  position: relative;
  width: 100%;
  max-width: 680px;
  margin: 1.5rem auto;
  border-radius: 1.5rem;
  overflow: hidden;
  box-shadow: 0 6px 32px rgba(32,32,44,0.2);
  background: transparent;
  transition: box-shadow 0.2s;
}
.gc-container > .gc-inner-gradient {
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, #ed6ea0 0%, #ec8c69 100%);
  filter: blur(0px);
  z-index: 1;
}
.gc-container > .gc-game-content {
  position: absolute;
  inset: 0;
  z-index: 2;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Responsive aspect fix: keep width mobile-friendly */
@media (max-width: 760px) {
  .gc-container { max-width: 100vw; border-radius: 1rem; }
}

/* Fullscreen */
.gc-fullscreen {
  position: fixed !important;
  inset: 0;
  width: 100vw;
  height: 100vh;
  border-radius: 0 !important;
  max-width: none;
  z-index: 9999;
}
.gc-fullscreen > .gc-inner-gradient,
.gc-fullscreen > .gc-game-content { border-radius: 0 !important; }

/* Toolbar styles */
.gc-toolbar {
  position: absolute;
  left: 0;
  bottom: 0;
  width: 100%;
  min-height: 48px;
  background: rgba(27, 27, 38, 0.7);
  backdrop-filter: blur(2px);
  display: flex;
  align-items: center;
  padding: 0.25rem 1rem;
  z-index: 3;
  box-sizing: border-box;
  border-bottom-left-radius: 1.5rem;
  border-bottom-right-radius: 1.5rem;
}
.gc-fullscreen .gc-toolbar {
  position: fixed;
  border-radius: 0;
}

/* Layout align left/right */
.gc-toolbar-spacer { flex: 1; }

/* Buttons */
.gc-btn {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  background: rgba(255,255,255,0.05);
  color: #fff;
  font-size: 1rem;
  border: none;
  cursor: pointer;
  border-radius: 0.75rem;
  padding: 0.4rem 1.1rem 0.4rem 0.7rem;
  margin: 0 0.2rem;
  font-family: inherit;
  font-weight: 500;
  box-shadow: 0 2px 6px rgba(40,20,60,0.09);
  transition: background 0.18s, box-shadow 0.18s;
}
.gc-btn:hover {
  background: rgba(250,250,250,0.18);
  box-shadow: 0 5px 16px rgba(60,20,80,0.13);
}
.gc-icon { width: 1.15em; height: 1.15em; display: block; }

@media (max-width: 540px) {
  .gc-toolbar { min-height: 40px; padding: 0.1rem 0.35rem; }
  .gc-btn { font-size: 0.87rem; padding: 0.3rem 0.7rem 0.3rem 0.5rem;}
}

/* Hide gradient under toolbar in fullscreen for a flat look */
.gc-fullscreen .gc-inner-gradient { background: #292946; }
</style>
