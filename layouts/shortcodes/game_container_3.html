{{/* Get ratio parameter, default to "16:9" */}}
{{ $ratioStr := default "16:9" (.Get "ratio") }}
{{ $aspectMap := dict "16:9" "aspect-16-9" "9:16" "aspect-9-16" "4:3" "aspect-4-3" "3:4" "aspect-3-4" }}
{{ $aspectClass := index $aspectMap $ratioStr | default "aspect-16-9" }}

{{/* Unique instance ID */}}
{{ $gcID := printf "gc-%d" .Ordinal }}

<div id="{{ $gcID }}" class="game-container {{ $aspectClass }}">
{{/*  <div id="game-container" class="game-container {{ $aspectClass }}">  */}}
  {{ .Inner }}

  <!-- Toolbar -->
  <div class="game-toolbar">
    <!-- Left: Mute Button -->
    <button id="mute-btn" aria-label="Toggle Mute">
      <svg id="mute-icon" xmlns="http://www.w3.org/2000/svg" fill="none"
           viewBox="0 0 24 24" stroke="currentColor" class="icon">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M11 5L6 9H2v6h4l5 4V5z" />
      </svg>
      <span>Mute</span>
    </button>

    <!-- Spacer -->
    <div class="toolbar-spacer"></div>

    <!-- Right: Fullscreen Button -->
    <button id="fullscreen-btn" aria-label="Toggle Fullscreen">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none"
           viewBox="0 0 24 24" stroke="currentColor" class="icon">
        <path stroke-linecap="round" stroke-linejoin="round"
              stroke-width="2"
              d="M4 8V4h4M4 4l5 5m11-5v4h-4m4-4l-5 5M4 16v4h4M4 20l5-5m11 5v-4h-4m4 4l-5-5"/>
      </svg>
      <span>Fullscreen</span>
    </button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const gameContainer = document.getElementById('{{ $gcID }}');  // Use unique ID
  {{/*  const gameContainer = document.getElementById('game-container');  */}}
  const fullscreenBtn = document.getElementById('fullscreen-btn');
  const muteBtn = document.getElementById('mute-btn');
  const muteIcon = document.getElementById('mute-icon');

  // Fullscreen toggle
  const enterFullscreen = () => {
    if (gameContainer.requestFullscreen) gameContainer.requestFullscreen();
    else if (gameContainer.webkitRequestFullscreen) gameContainer.webkitRequestFullscreen();
    else if (gameContainer.msRequestFullscreen) gameContainer.msRequestFullscreen();
  };
  const exitFullscreen = () => {
    if (document.exitFullscreen) document.exitFullscreen();
    else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
    else if (document.msExitFullscreen) document.msExitFullscreen();
  };
  fullscreenBtn.addEventListener('click', () =>
    document.fullscreenElement ? exitFullscreen() : enterFullscreen()
  );
  document.addEventListener('fullscreenchange', () => {
    const isFull = !!document.fullscreenElement;
    gameContainer.classList.toggle('fullscreen', isFull);
    fullscreenBtn.querySelector('span').textContent = isFull ? 'Exit Fullscreen' : 'Fullscreen';
  });

  // Mute toggle (basic placeholder: hook into your game's audio element)
  let isMuted = false;
  muteBtn.addEventListener('click', () => {
    isMuted = !isMuted;
    muteBtn.querySelector('span').textContent = isMuted ? 'Unmute' : 'Mute';
    muteIcon.innerHTML = isMuted
      ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5L6 9H2v6h4l5 4V5z M15 9l4 4m0-4l-4 4"/>'
      : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5L6 9H2v6h4l5 4V5z" />';
    
    // Example: if your game uses an <audio> tag with id="game-audio"
    const audioEl = document.getElementById('game-audio');
    const audio = container.querySelector('audio, video');
    if (audioEl || audio) audioEl.muted = isMuted;
  });
});
</script>

<style>
/* Aspect Ratios */
.aspect-16-9 { padding-top: 56.25%; }
.aspect-9-16 { padding-top: 177.78%; }
.aspect-4-3  { padding-top: 75%; }
.aspect-3-4  { padding-top: 133.33%; }

/* Container */
.game-container {
  position: relative;
  width: 100%;
  background: #121212;
  border-radius: 1rem;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  overflow: hidden;
  transition: all 0.3s;
}
.game-container > * {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
}

/* Fullscreen mode */
.game-container.fullscreen {
  position: fixed !important;
  inset: 0;
  width: 100vw;
  height: 100vh;
  padding-top: 0 !important;
  border-radius: 0;
  z-index: 9999;
}

/* Toolbar like YouTube bottom menu */
.game-toolbar {
  position: relative; /* Overlay inside game by default */
  left: 0;
  bottom: 0;
  width: 100%;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  padding: 0.4rem 0.8rem;
  box-sizing: border-box;
}
.toolbar-spacer {
  flex: 1;
}

/* When fullscreen, pin to bottom of screen */
.game-container.fullscreen .game-toolbar {
  position: relative;
  bottom: 0;
  left: 0;
  width: 100%;
  z-index: 10000;
}


/* Buttons */
#fullscreen-btn, #mute-btn {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  background: transparent;
  color: white;
  font-size: 0.85rem;
  border: none;
  cursor: pointer;
  transition: background 0.3s;
  border-radius: 4px;
  padding: 0.3rem 0.6rem;
}
#fullscreen-btn:hover,
#mute-btn:hover {
  background: rgba(255, 255, 255, 0.15);
}
.icon {
  width: 0.9rem;
  height: 0.9rem;
}

/* Small screens */
@media (max-width: 768px) {
  #fullscreen-btn, #mute-btn {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
  }
  .icon {
    width: 0.8rem;
    height: 0.8rem;
  }
}

/* Very small screens */
@media (max-width: 480px) {
  .game-container { border-radius: 0.5rem; }
  #fullscreen-btn, #mute-btn { font-size: 0.7rem; }
  .icon {
    width: 0.7rem;
    height: 0.7rem;
  }
}
</style>
